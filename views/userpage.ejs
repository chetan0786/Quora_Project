<!DOCTYPE html>
<head>
	<meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.100.2/css/materialize.min.css">
  <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">
    <title>Storybooks</title>
</head>
<body>
	
	<%- include('partials/header'); -%>

   <div class = "container">
        <div class="row">
            <div class="col s0 m1"></div>
  <div class="col s12 m10">
    <div class="card ">
      <div class="card-content ">
      
     
      <div class="row">
          
     <div class="col s12 m12">
         
          
        <span class="card-title " style="background-color: aliceblue;text-align:center;padding:20px;"><img src="<%= userDetails.image%>" style="height: 100px;" class="circle responsive-img"><br><%= userDetails.name%></span>
              
         </div>
          </div>
          <div class="row">
          <div class="col s6 m6   followersClass" style="height:100%;border:1px solid black;text-align:center;font-weight:bold;cursor:pointer;">
          FOLLOWERS: <%= userDetails.followers.length%>
          </div>
          <div class="col s6 m6" style="height:100%;border:1px solid black;text-align:center;font-weight:bold;cursor:pointer;">
          FOLLOWING: <%= userDetails.following.length%>
          </div>
      
          
          </div>
          
          <hr>
          
          <div class="row">
               
          <div class="col s12 m6" style="height:100%;text-align:left">
              <div ><i class="fa fa-lg fa-envelope"></i> <%= userDetails.email%></div>
              <div ><i class="fa fa-lg fa-edit"></i> Writer</div>
          </div>
          <div class="col s12 m6" style="height:100%;text-align:left">
              <div style="display:inline-block;font-weight:bold;" >About: </div>
              
          
              
              <div>
              <div style="display:inline-block;" class="displayAbout" id="_displayAbout"> 
                  
                 <%= userDetails.about%>
              
              </div>
            
              </div>
              
          </div>
          
          </div>
          
          
          <hr>
          
          
          
          
           <div class="row">
               <div class="col s0 m2"></div>
          <div class="col s12 m8" style="height:100%;text-align:center">
              <button class="btn blue center" id="_followBtn" onclick="followUser()" style="display:inline-block;width:100%;margin:10px;">Follow</button>
              <button class="btn green center" id="_followingBtn"  onclick="unfollowUser()"style="display:inline-block;width:100%;margin:10px;border:2px solid black;display:none">Following</button>
          </div>
          <div class="col s0 m2"></div>
          
          </div>
          
          
          
          <hr>
          
          
          
           <div class="row">
               
          <div class="col s6 m6" style="height:100%;text-align:center;">
              <button class="btn red center" id=""  style="display:inline-block;margin:10px;"><i class="fa fa-lg fa-book"></i></button>
          </div>
               <div class="col s6 m6" style="height:100%;text-align:center;">
              <button class="btn black center" id="" style="display:inline-block;margin:10px;"><i class="fa fa-lg fa-send"></i></button>
          </div>
          
          
          </div>
          
      
  </div>
   </div>
            </div>
            <div class="col s0 m1  ">
            </div>

 
</div>
     
           
           
           
           
           

           
           
           
           
           
           
           
          

           
           
           
           
           
           
           
           
        
     
          
           
           
           
           
           
           
           
           
           
           
           
    </div>
    
    
    
    
    <%- include('./partials/footerForStories') -%>


</body>

	 <script
  src="https://code.jquery.com/jquery-3.2.1.js"
  integrity="sha256-DZAnKJ/6XZ9si04Hgrsxu/8s717jcIzLy3oi35EouyE="
  crossorigin="anonymous">
  </script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.100.2/js/materialize.min.js"></script>
  <script>
    $(document).ready(() => {
      $('.button-collapse').sideNav();
        
    });
      
      
      checkUserRelation();
      
      function followUser(){
          $('#_followBtn').hide();
           $('#_followingBtn').show();
          
          
          
          
           $.ajax({
          type: "POST",
          url: "/followuser",
          data:  { receiverData: {name : "<%=userDetails.name%>",
                                email: "<%= userDetails.email%>" 
                                 }
                 },
          success: function(response_data){
              
          $('.followersClass').html('FOLLOWERS: '+response_data.length)
              }
          }
           );
  
      }
      
      function unfollowUser(){
          $('#_followBtn').show();
           $('#_followingBtn').hide();
          
           $.ajax({
          type: "POST",
          url: "/unfollowuser",
          data:  { receiverData: {name : "<%=userDetails.name%>",
                                email: "<%= userDetails.email%>" 
                                 }
                 },
          success: function(response_data){
              console.log(response_data)
              location.reload();
          $('.followersClass').html('FOLLOWERS: '+response_data.length)
              }
          }
           );
          
      }
      
          
          function checkUserRelation(){
              
              
              if("<%= userDetails.email%>" == "<%=useremail%>")
                 {
                     $('#_followBtn').hide();
                      $('#_followingBtn').hide();
              return;
                 }
              
              
              
              $.ajax({
                type: "POST",
                url: "/userRelations",
                data:  { receiverData: {name : "<%=userDetails.name%>",
                                email: "<%= userDetails.email%>" 
                                 }
                       },
                success: function(response_data){
                    
                    console.log(response_data)
                    
                        if(response_data == "IS_FOLLOWING"){
                            $('#_followBtn').hide();
                            $('#_followingBtn').show();
                        }
               
                }
                }
              );
          }
      
  </script>



